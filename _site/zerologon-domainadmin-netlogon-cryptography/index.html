<!DOCTYPE html> <html lang="en-US"> <head prefix="og: http://ogp.me/ns#"> <meta charset="UTF-8" /> <meta http-equiv="X-UA-Compatible" content="ie=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="Blog | Cyber Security" /> <meta name="apple-mobile-web-app-status-bar-style" content="#fff" /> <meta name="apple-mobile-web-app-title" content="Blog | Cyber Security" /> <title> Zerologon (CVE-2020-1472) &lt;-&gt; Red|Blue Teams - Blog | Cyber Security </title> <link rel="alternate" href="http://localhost:4000/zerologon-domainadmin-netlogon-cryptography/" hreflang="en-US" /> <link rel="canonical" href="http://localhost:4000/zerologon-domainadmin-netlogon-cryptography/" /> <meta name="description" content="CVE-2020-1472" /> <meta name="referrer" content="no-referrer-when-downgrade" /> <meta property="fb:app_id" content="" /> <meta property="og:site_name" content="Zerologon (CVE-2020-1472) &lt;-&gt; Red|Blue Teams | facebook_username" /> <meta property="og:title" content="Zerologon (CVE-2020-1472) &lt;-&gt; Red|Blue Teams | facebook_username" /> <meta property="og:type" content="website" /> <meta property="og:url" content="http://localhost:4000/zerologon-domainadmin-netlogon-cryptography/" /> <meta property="og:description" content="CVE-2020-1472" /> <meta property="og:image" content="http://localhost:4000/assets/img/ogp.png" /> <meta property="og:image:width" content="640" /> <meta property="og:image:height" content="640" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:title" content="Zerologon (CVE-2020-1472) &lt;-&gt; Red|Blue Teams | twitter_username" /> <meta name="twitter:url" content="http://localhost:4000/zerologon-domainadmin-netlogon-cryptography/" /> <meta name="twitter:site" content="@twitter_username" /> <meta name="twitter:creator" content="@twitter_username" /> <meta name="twitter:description" content="CVE-2020-1472" /> <meta name="twitter:image" content="http://localhost:4000/assets/img/ogp.png" /> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Blog | Cyber Security" /> <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png" /> <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicons/favicon-32x32.png" /> <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicons/favicon-16x16.png" /> <link rel="manifest" href="/assets/favicons/site.webmanifest" /> <link rel="mask-icon" href="/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" /> <meta name="apple-mobile-web-app-title" content="Jekyll Klise" /> <meta name="application-name" content="Jekyll Klise" /> <meta name="msapplication-TileColor" content="#da532c" /> <meta name="theme-color" content="#2c2c2c" /> <link rel="stylesheet" href="/assets/css/style.css" /> </head> <body data-theme="dark"> <div class="navbar" role="navigation"> <nav class="menu"> <input type="checkbox" id="menu-trigger" class="menu-trigger" /> <label for="menu-trigger"> <span class="menu-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <path d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z" /> </svg> </span> </label> <a id="mode"> <svg class="mode-sunny" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>LIGHT</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> <svg class="mode-moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 512 512" > <title>DARK</title> <line x1="256" y1="48" x2="256" y2="96" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="256" y1="416" x2="256" y2="464" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="108.92" x2="369.14" y2="142.86" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="369.14" x2="108.92" y2="403.08" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="464" y1="256" x2="416" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="96" y1="256" x2="48" y2="256" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="403.08" y1="403.08" x2="369.14" y2="369.14" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <line x1="142.86" y1="142.86" x2="108.92" y2="108.92" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> <circle cx="256" cy="256" r="80" style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px" /> </svg> </a> <div class="trigger"> <div class="trigger-container"><a class="menu-link" href="/">home</a><a class="menu-link" href="/archive/">archive</a><a class="menu-link" href="/about/">about</a><a class="menu-link rss" href="/feed.xml"> <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 512 512" fill="#ED812E" > <title>RSS</title> <path d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z" /> <path d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z" /> <path d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z" /> </svg> </a> </div> </div> </nav> </div> <div class="wrapper post"> <main class="page-content" aria-label="Content"> <article itemscope itemtype="https://schema.org/BlogPosting"> <header class="header"> <div class="tags"> <span itemprop="keywords"> <a class="tag" href="/tags/#exploit">EXPLOIT</a>, <a class="tag" href="/tags/#poc">POC</a>, <a class="tag" href="/tags/#python">PYTHON</a>, <a class="tag" href="/tags/#github">GITHUB</a> </span> </div> <h1 class="header-title" itemprop="headline">Zerologon (CVE-2020-1472) &lt;-&gt; Red|Blue Teams</h1> <div class="post-meta"> <time datetime="2020-09-14T11:00:00+07:00" itemprop="datePublished"> Sep 14, 2020 </time> <span itemprop="author" itemscope itemtype="https://schema.org/Person"> <span itemprop="name">Santhosh Baswa</span> </span> <time hidden datetime="2020-09-17T21:49:47+07:00" itemprop="dateModified"> Sep 14, 2020 </time> <span hidden itemprop="publisher" itemtype="Person">Santhosh Baswa</span> <span hidden itemprop="image"></span> <span hidden itemprop="mainEntityOfPage"><p>This vulnerability allowed threat actor to foothold on your enterprise network to become a domain admin with single click.</p> </span> </div> </header> <div class="page-content" itemprop="articleBody"> <p>This vulnerability allowed threat actor to foothold on your enterprise network to become a domain admin with single click.</p> <p>The vulnerability stems from a flaw in a cryptographic authentication scheme used by the Netlogon Remote Protocol, which among other things can be used to update computer passwords. This flaw allows attackers to impersonate any computer, including the domain controller itself, and execute remote procedure calls on their behalf.</p> <h4 id="redteam---offensive-toolsscripts"> <a href="#redteam---offensive-toolsscripts" class="anchor-head"></a> RedTeam - Offensive Tools/Scripts: </h4> <figure> <img src="https://raw.githubusercontent.com/zer0trustsec/zer0trustsec.github.io/master/_posts/zerologon-domainadmin-netlogon-cryptography/Exploit.png" alt="" /> <figcaption> Python Exploit - ZeroLogon (CVE-2020-1472) </figcaption> </figure> <ul> <li><a href="https://github.com/SecuraBV/CVE-2020-1472">ZeroLogon- POC Script-1</a></li> <li><a href="https://github.com/blackarrowsec/redteam-research/tree/master/CVE-2020-1472">ZeroLogon- POC Script-2</a></li> <li><a href="https://github.com/gentilkiwi/mimikatz/releases/tag/2.2.0-20200917">ZeroLogon - Mimikatz</a></li> <li><a href="https://github.com/BC-SECURITY/Invoke-ZeroLogon">Zerologon - Powershell</a></li> </ul> <h4 id="blueteam---defense"> <a href="#blueteam---defense" class="anchor-head"></a> BlueTeam - Defense: </h4> <p>Windows Event Correlation:</p> <ul> <li>Keep an eye our Event ID 4624 followed by a 4742.</li> <li>Failed attempts look for Event ID 5805</li> </ul> <figure> <img src="https://raw.githubusercontent.com/zer0trustsec/zer0trustsec.github.io/master/_posts/zerologon-domainadmin-netlogon-cryptography/zerologon_blueteam.png" alt="" /> <figcaption> Windows Events - ZeroLogon (CVE-2020-1472) </figcaption> </figure> <h4 id="snort-rule"> <a href="#snort-rule" class="anchor-head"></a> Snort Rule </h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alert tcp any any -&gt; <span class="o">[!</span>&lt;domaincontrollers to exclude here] <span class="o">[</span>49152:65535] <span class="o">(</span>msg:<span class="s2">"Possible DCSync Detected"</span><span class="p">;</span> flow:to_server,established<span class="p">;</span> flags:PA<span class="p">;</span> content:<span class="s2">"|00 03 10 00 00 00|"</span><span class="p">;</span> depth:8<span class="p">;</span> content:<span class="s2">"|03 00|"</span><span class="p">;</span> distance:14<span class="p">;</span> classtype:attempted-admin<span class="p">;</span> sid:20166316<span class="p">;</span><span class="o">)</span>
</code></pre></div></div> <h4 id="other-detections"> <a href="#other-detections" class="anchor-head"></a> Other Detections: </h4> <ul> <li><a href="https://github.com/sbousseaden/EVTX-ATTACK-SAMPLES/blob/master/Credential%20Access/remote_pwd_reset_rpc_mimikatz_postzerologon_target_DC.evtx">EVTX- Simulation Logs by @sbousseaden </a></li> <li><a href="https://corelight.blog/2020/09/16/detecting-zerologon-cve-2020-1472-with-zeek/">Detection - Zeek</a></li> </ul> <h4 id="reference-articlesposts"> <a href="#reference-articlesposts" class="anchor-head"></a> Reference Articles/Posts: </h4> <p><a href="https://www.secura.com/blog/zero-logon">ZeroLogon Article</a> <a href="https://twitter.com/SBousseaden/status/1306631518618607623">Twitter - @SBousseaden</a> <a href="https://twitter.com/joshlemon/status/1306487256480460805">Twitter - @joshlemon</a></p> </div> </article> </main> <small class="post-updated-at">updated_at 17-09-2020</small> <nav class="post-nav"> <a class="post-nav-item post-nav-prev" href="/redteam-tip-change-mac-address/" > <div class="nav-arrow">Previous</div> <span class="post-title">RedTeam Tip - Change MAC address in endpoint</span> </a> <a class="post-nav-item post-nav-next" href="/extract-saved-browser-passwords-using-powershell/"> <div class="nav-arrow">Next</div> <span class="post-title">Extract stored passwords from browser using Powershell</span> </a> </nav> <footer class="footer"> <a class="footer_item" href="/thanks">ack.</a> <a class="footer_item" href="javascript::void(0)">resume</a> <a class="footer_item" href="/feed.xml">rss</a> <span class="footer_item">&copy; 2020</span> <small class="footer_copyright"> <!-- Klisé Theme: https://github.com/piharpi/jekyll-klise --> <a href="https://github.com/piharpi/jekyll-klise" target="_blank" rel="noreferrer noopener" >klisé</a > theme on <a href="https://jekyllrb.com" target="_blank" rel="noreferrer noopener" >jekyll</a > </small> </footer> <script src="/assets/js/main.js" defer="defer"></script> </div> </body> </html>
